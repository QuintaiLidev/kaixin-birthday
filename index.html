<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Happy Birthday, Kaixin</title>

  <!-- âœ… è¿›å…¥é¡µé¢ç«‹åˆ»åŠ  loadingï¼ˆé˜²æ­¢é—ªçƒï¼‰ -->
  <script>
    document.documentElement.classList.add('is-loading');
  </script>

  <!-- âœ… å°ä¼˜åŒ–ï¼šæå‰å»ºç«‹è¿æ¥ï¼ˆåŒåŸŸä¹Ÿæœ‰å¸®åŠ©ï¼‰ -->
  <link rel="preconnect" href="https://quintailidev.github.io" />
  <link rel="dns-prefetch" href="https://quintailidev.github.io" />

  <style>
    :root {
      --bg1: #ffe2f0;
      --bg2: #f8f0ff;
      --bg3: #ffe9d2;
      --card: rgba(255, 255, 255, 0.72);
      --card2: rgba(255, 255, 255, 0.55);
      --text: #2a2a2a;
      --muted: #666;
      --shadow: 0 18px 45px rgba(0, 0, 0, 0.12);
      --radius: 22px;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB",
        "Microsoft YaHei", system-ui, sans-serif;
      background: radial-gradient(circle at 0% 0%, var(--bg1), var(--bg2), var(--bg3));
      background-size: 200% 200%;
      animation: bgMove 16s linear infinite alternate;
      overflow-x: hidden;
    }

    @keyframes bgMove {
      0% { background-position: 0% 0%; }
      50% { background-position: 50% 60%; }
      100% { background-position: 100% 10%; }
    }

    .glow-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 20% 15%, rgba(255, 255, 255, 0.35), transparent 40%),
        radial-gradient(circle at 80% 25%, rgba(255, 255, 255, 0.25), transparent 45%),
        radial-gradient(circle at 55% 80%, rgba(255, 255, 255, 0.22), transparent 42%);
      mix-blend-mode: soft-light;
      filter: blur(0.2px);
      opacity: 0.9;
    }

    .wrap {
      width: min(960px, 92vw);
      margin: 34px auto 70px;
      position: relative;
      z-index: 2;
    }

    .hero {
      border-radius: var(--radius);
      padding: 28px 22px 20px;
      background: linear-gradient(135deg, var(--card), var(--card2));
      box-shadow: var(--shadow);
      border: 1px solid rgba(255, 255, 255, 0.55);
      backdrop-filter: blur(10px);
      overflow: hidden;
      position: relative;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: -60px -80px auto auto;
      width: 240px;
      height: 240px;
      background: radial-gradient(circle, rgba(255, 77, 141, 0.30), transparent 60%);
      transform: rotate(14deg);
      filter: blur(2px);
    }

    .title {
      margin: 0;
      font-weight: 800;
      font-size: clamp(30px, 5vw, 48px);
      letter-spacing: 0.5px;
      text-align: center;
      animation: titleGlow 4s ease-in-out infinite;
    }

    @keyframes titleGlow {
      0% { text-shadow: 0 0 0px rgba(255, 255, 255, 0.4); transform: scale(1); }
      50% { text-shadow: 0 0 18px rgba(255, 255, 255, 0.95); transform: scale(1.03); }
      100% { text-shadow: 0 0 0px rgba(255, 255, 255, 0.4); transform: scale(1); }
    }

    .subtitle {
      margin: 10px 0 0;
      text-align: center;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.7;
    }

    .chips {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.65);
      font-size: 13px;
      color: rgba(0, 0, 0, 0.72);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.07);
    }

    .mini-icon {
      display: inline-grid;
      place-items: center;
      width: 16px;
      height: 16px;
      margin-right: 6px;
      vertical-align: -2px;
    }

    .mini-icon svg {
      width: 16px;
      height: 16px;
      display: block;
    }

    .icon-perfume svg {
      width: 18px;
      height: 18px;
      display: block;
    }

    .countdown {
      margin-top: 12px;
      text-align: center;
      font-size: 14px;
      color: rgba(0, 0, 0, 0.75);
    }

    .section {
      margin-top: 18px;
      border-radius: var(--radius);
      background: rgba(255, 255, 255, 0.65);
      border: 1px solid rgba(255, 255, 255, 0.6);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      padding: 18px;
    }

    .section h2 {
      margin: 0 0 12px;
      font-size: 18px;
      letter-spacing: 0.3px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    @media (max-width: 720px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      border-radius: 18px;
      padding: 14px 14px 12px;
      background: rgba(255, 255, 255, 0.70);
      border: 1px solid rgba(255, 255, 255, 0.75);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.08);
      transform: translateY(10px);
      opacity: 0;
      transition: transform 700ms ease, opacity 700ms ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: auto -40px -40px auto;
      width: 160px;
      height: 160px;
      background: radial-gradient(circle, rgba(111, 108, 255, 0.18), transparent 60%);
      transform: rotate(12deg);
      z-index: 0;
    }

    .card.show {
      transform: translateY(0);
      opacity: 1;
    }

    .card .top {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      position: relative;
      z-index: 2;
    }

    .icon {
      width: 34px;
      height: 34px;
      display: grid;
      place-items: center;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.06);
      font-size: 18px;
    }

    .card h3 { margin: 0; font-size: 15px; }

    .card-body {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      position: relative;
      z-index: 2;
    }

    .card-photo {
      width: 42%;
      min-width: 150px;
      aspect-ratio: 4 / 3;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.08);
      background: rgba(255, 255, 255, 0.55);
      position: relative;
    }

    /* âœ… Skeleton shimmerï¼šå›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥æ—¶æ˜¾ç¤º */
    .card-photo::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg,
          rgba(255, 255, 255, 0.20) 0%,
          rgba(255, 255, 255, 0.62) 50%,
          rgba(255, 255, 255, 0.20) 100%);
      transform: translateX(-100%);
      animation: shimmer 1.2s infinite;
    }

    @keyframes shimmer { to { transform: translateX(100%); } }

    .card-photo.is-loaded::after { display: none; }

    .card-photo img {
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
      transform: scale(1.02);
      transition: transform 600ms ease, opacity 380ms ease;
      opacity: 0;
    }

    .card-photo.is-loaded img { opacity: 1; }
    .card:hover .card-photo img { transform: scale(1.07); }

    .card-text { flex: 1; min-width: 0; }
    .card-text p {
      margin: 0;
      color: rgba(0, 0, 0, 0.72);
      line-height: 1.7;
      font-size: 14px;
    }

    @media (max-width: 720px) {
      .card-body { flex-direction: column; }
      .card-photo { width: 100%; min-width: 0; }
    }

    .letter {
      line-height: 1.9;
      font-size: 15px;
      color: rgba(0, 0, 0, 0.78);
      white-space: pre-line;
    }

    .sign {
      margin-top: 12px;
      color: rgba(0, 0, 0, 0.70);
      font-size: 14px;
      text-align: right;
    }

    .footer {
      margin-top: 16px;
      text-align: center;
      color: rgba(0, 0, 0, 0.55);
      font-size: 12px;
    }

    /* æ¼‚æµ®çˆ±å¿ƒ */
    .heart {
      position: fixed;
      bottom: -40px;
      z-index: 1;
      pointer-events: none;
      user-select: none;
      color: rgba(255, 77, 141, 0.72);
      animation: floatUp 8s linear forwards;
      filter: drop-shadow(0 10px 14px rgba(0, 0, 0, 0.08));
    }

    @keyframes floatUp {
      0% { transform: translateY(0) scale(1) rotate(0deg); opacity: 0; }
      12% { opacity: 1; }
      100% { transform: translateY(-120vh) scale(1.5) rotate(16deg); opacity: 0; }
    }

    .btns {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
    }

    button {
      border: 0;
      border-radius: 999px;
      padding: 10px 14px;
      cursor: pointer;
      background: rgba(255, 255, 255, 0.75);
      border: 1px solid rgba(255, 255, 255, 0.85);
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.08);
      color: rgba(0, 0, 0, 0.78);
      font-size: 14px;
    }

    button:active { transform: translateY(1px); }

    /* =========================
       âœ… Loaderï¼šåªç­‰å…³é”®å›¾
       ========================= */
    html.is-loading body { overflow: hidden; }

    #app {
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 520ms ease, transform 520ms ease;
    }

    html:not(.is-loading) #app {
      opacity: 1;
      transform: translateY(0);
    }

    .loader-overlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: grid;
      place-items: center;
      background: radial-gradient(circle at 0% 0%,
          rgba(255, 226, 240, 0.95),
          rgba(248, 240, 255, 0.95),
          rgba(255, 233, 210, 0.95));
      backdrop-filter: blur(10px);
    }

    .loader-overlay.hide {
      opacity: 0;
      pointer-events: none;
      transition: opacity 360ms ease;
    }

    .loader-card {
      width: min(360px, 86vw);
      border-radius: 18px;
      padding: 18px 16px;
      background: rgba(255, 255, 255, 0.72);
      border: 1px solid rgba(255, 255, 255, 0.7);
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.12);
      text-align: center;
    }

    .spinner {
      width: 44px;
      height: 44px;
      margin: 4px auto 10px;
      border-radius: 999px;
      border: 4px solid rgba(0, 0, 0, 0.10);
      border-top-color: rgba(0, 0, 0, 0.55);
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .loader-text {
      font-size: 14px;
      color: rgba(0, 0, 0, 0.75);
    }

    .loader-sub {
      margin-top: 6px;
      font-size: 12px;
      color: rgba(0, 0, 0, 0.55);
    }

    /* =========================
       âœ… æ–°å¢ï¼šå¤±è´¥æç¤º/ç‚¹æˆ‘é‡è¯•ï¼ˆä¸å½±å“PCï¼‰
       ========================= */
    .card-photo.is-failed::after { display: none; }

    .img-retry {
      position: absolute;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(255, 255, 255, 0.55);
      backdrop-filter: blur(6px);
    }

    .card-photo.is-failed .img-retry {
      display: grid;
    }

    .img-retry button {
      border-radius: 999px;
      padding: 10px 14px;
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.92);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.12);
      font-size: 13px;
      color: rgba(0, 0, 0, 0.78);
    }
  </style>

  <base href="https://quintailidev.github.io/kaixin-birthday/">
</head>

<body>
  <div class="glow-layer"></div>

  <div id="loaderOverlay" class="loader-overlay" aria-live="polite">
    <div class="loader-card">
      <div class="spinner"></div>
      <div id="loaderText" class="loader-text">æ­£åœ¨æ‰“å¼€ç¤¼ç‰©â€¦ 0%</div>
      <div class="loader-sub">é¦–å±å…ˆåˆ°ï¼Œå›å¿†æ…¢æ…¢è·Ÿä¸Š ğŸ§³</div>
    </div>
  </div>

  <div class="wrap" id="app">
    <header class="hero">
      <h1 class="title">ç”Ÿæ—¥å¿«ä¹, å‡¯é¦¨ ğŸ‚</h1>
      <p class="subtitle">
        æˆ‘æŠŠæˆ‘è®°å¿†ä¸­çš„ä¸€äº›ç”»é¢ï¼Œæ”¾è¿›è¿™ä¸ªå°å°çš„é¡µé¢é‡Œã€‚<br />
        æƒ³è®©ä½ åœ¨æ‰“å¼€çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ç‚¹ç‚¹æƒŠå–œã€‚
      </p>

      <div class="chips">
        <span class="chip">ğŸ  è¿ªå£«å°¼çš„é‚£å¤©</span>
        <span class="chip">ğŸ©° ç™½è›‡ä¼ çš„å¿ƒåŠ¨</span>
        <span class="chip">ğŸ’„ ä¸‡èƒœå›´é‚£é¡¿æ³°é¤</span>
        <span class="chip">ğŸŒŠ æƒ å·çš„æµ·å’Œæ— è¾¹æ³³æ± </span>

        <span class="chip">
          <span class="mini-icon">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M9 3.5c0-.55.45-1 1-1h4c.55 0 1 .45 1 1v2H9v-2Z" fill="rgba(180,140,60,0.95)" />
              <path
                d="M8.5 5.5h7c.55 0 1 .45 1 1v1.2c0 .44-.29.83-.72.96l-1.28.38H9.5l-1.28-.38A1 1 0 0 1 7.5 7.7V6.5c0-.55.45-1 1-1Z"
                fill="rgba(210,170,80,0.95)" />
              <path
                d="M8.2 9.4c.12-.6.65-1.04 1.26-1.04h5.08c.6 0 1.14.44 1.26 1.04l1.1 5.7c.22 1.15-.66 2.2-1.83 2.2H8.93c-1.17 0-2.05-1.05-1.83-2.2l1.1-5.7Z"
                fill="rgba(255,255,255,0.75)" stroke="rgba(255,255,255,0.75)" />
              <path
                d="M9.2 14.1c.07-.4.42-.7.83-.7h3.94c.41 0 .76.29.83.7l.55 2.9c.1.54-.31 1.04-.86 1.04H9.51c-.55 0-.96-.5-.86-1.04l.55-2.9Z"
                fill="rgba(255,77,141,0.55)" />
              <path d="M10.2 9.6c.4-.2.86-.3 1.8-.3" stroke="rgba(255,255,255,0.85)" stroke-width="1.2"
                stroke-linecap="round" />
            </svg>
          </span>
          éª„å‚²çš„è¿ªå¥¥å°å§
        </span>
      </div>

      <div class="countdown" id="countdown">æ­£åœ¨åŠ è½½å€’è®¡æ—¶â€¦</div>

      <div class="btns">
        <button id="btnHearts" type="button">æ¥ç‚¹çˆ±å¿ƒ</button>
        <button id="btnScroll" type="button">å»çœ‹å›å¿†</button>
      </div>
    </header>

    <section class="section" id="memories">
      <h2>æˆ‘æ¸…æ™°è®°å¾—çš„å‡ ä¸ªç¬é—´</h2>

      <div class="grid">
        <!-- 1ï¼ˆâœ… å…³é”®å›¾ï¼šé¦–å±ä¼˜å…ˆï¼‰ -->
        <div class="card reveal">
          <div class="top">
            <div class="icon">ğŸ°</div>
            <h3>åŸå ¡å‰ï¼Œç™½é›ªå…¬ä¸»åˆšå¥½è·¯è¿‡</h3>
          </div>
          <div class="card-body">
            <div class="card-photo">
              <div class="img-retry"><button type="button">å›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œç‚¹æˆ‘é‡è¯•</button></div>
              <img
                src="https://quintailidev.github.io/kaixin-birthday/images/disney_castle1.jpg?v=3"
                alt="è¿ªå£«å°¼åŸå ¡å‰çš„å›å¿†"
                loading="eager"
                fetchpriority="high"
                data-critical="1"
                decoding="async"
                referrerpolicy="no-referrer">
            </div>
            <div class="card-text">
              <p>
                é¦™æ¸¯è¿ªå£«å°¼åŸå ¡å‰æˆ‘ç»™ä½ æ‹ç…§çš„æ—¶å€™ï¼Œç™½é›ªå…¬ä¸»åˆšå¥½ç»è¿‡ï¼Œè¿˜è·Ÿä½ æ‰“æ‹›å‘¼ã€‚
                é‚£ä¸€ä¸‹å¾ˆç¥å¥‡ï¼Œæˆ‘è§‰å¾—ä½ å°±æ˜¯äººç¾¤ä¸­é‚£ä¸ªç‰¹åˆ«äº®çœ¼çš„å­˜åœ¨ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- 2ï¼ˆâœ… å…³é”®å›¾ï¼šé¦–å±ä¼˜å…ˆï¼‰ -->
        <div class="card reveal">
          <div class="top">
            <div class="icon">â„ï¸</div>
            <h3>å†°é›ªå¥‡ç¼˜é‚£è¾¹çš„å–·æ³‰</h3>
          </div>
          <div class="card-body">
            <div class="card-photo">
              <div class="img-retry"><button type="button">å›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œç‚¹æˆ‘é‡è¯•</button></div>
              <img
                src="https://quintailidev.github.io/kaixin-birthday/images/frozen_fountain.jpg?v=3"
                alt="å–·æ³‰è¾¹çš„ç¬é—´"
                loading="eager"
                fetchpriority="high"
                data-critical="1"
                decoding="async"
                referrerpolicy="no-referrer">
            </div>
            <div class="card-text">
              <p>
                ä½ ååœ¨é‚£é‡Œçš„æ ·å­ç‰¹åˆ«ç¾ï¼Œé»‘è‰²é‚£å¥—ç©¿æ­å¾ˆç»ã€‚
                å¾®é£å¹èµ·ä½ çš„è£™æ‘†ï¼Œæˆ‘è§‰å¾—ä½ å¥½åƒè¦é•¿å‡ºç¿…è†€é£èµ·æ¥ï¼Œæˆä¸ºåŠ¨ç”»é‡Œçš„ä»™å­ä¸€æ ·ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- 3ï¼ˆlazy + skeletonï¼‰ -->
        <div class="card reveal">
          <div class="top">
            <div class="icon">ğŸ©°</div>
            <h3>ç™½è›‡ä¼ çš„èŠ­è•¾èˆå‰§</h3>
          </div>
          <div class="card-body">
            <div class="card-photo">
              <div class="img-retry"><button type="button">å›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œç‚¹æˆ‘é‡è¯•</button></div>
              <img
                src="https://quintailidev.github.io/kaixin-birthday/images/white_snake.jpg?v=3"
                alt="ç™½è›‡ä¼ çš„èˆå°è®°å¿†"
                loading="lazy"
                decoding="async"
                referrerpolicy="no-referrer">
            </div>
            <div class="card-text">
              <p>
                æˆ‘ä»¬ä¸€èµ·çœ‹çš„é‚£åœºã€Šç™½è›‡ä¼ ã€‹ï¼Œæˆ‘è§‰å¾—æ¥è§¦åˆ°äº†ä¸–ç•Œä¸Šçš„ç¾å¥½å­˜åœ¨ã€‚
                å›å»çš„è·¯ä¸Šæˆ‘ä»¬å¼€å§‹äº†è§£å¯¹æ–¹ï¼Œä½ è¿˜åœ¨æˆ‘çš„æ‰‹ä¸Šäº²äº†ä¸€å£ï¼ŒçœŸçš„æœ‰ç§â€œå¿ƒåœ¨è¹¦è¹¦è·³â€çš„æ„Ÿè§‰ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- 4ï¼ˆlazy + skeletonï¼‰ -->
        <div class="card reveal">
          <div class="top">
            <div class="icon">ğŸ’„</div>
            <h3>ä¸‡èƒœå›´ï¼Œæ³°é¤å’Œé¦™å¥ˆå„¿å£çº¢</h3>
          </div>
          <div class="card-body">
            <div class="card-photo">
              <div class="img-retry"><button type="button">å›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œç‚¹æˆ‘é‡è¯•</button></div>
              <img
                src="https://quintailidev.github.io/kaixin-birthday/images/thaifood.jpg?v=3"
                alt="ä¸‡èƒœå›´é‚£é¡¿æ³°é¤"
                loading="lazy"
                decoding="async"
                referrerpolicy="no-referrer">
            </div>
            <div class="card-text">
              <p>
                é‚£å¤©æ³°é¤çš„å‘³é“æˆ‘å·²ç»è®°ä¸å¤ªæ¸…äº†ï¼Œä½†æˆ‘é€ä½ å£çº¢ï¼Œä½ çœ‹åˆ°å¡ç‰‡åå“­äº†çš„é‚£ä¸€åˆ»ï¼Œæˆ‘è®°çš„å¾ˆæ¸…æ¥šã€‚
                æˆ‘ä¹Ÿç‰¹åˆ«æ„ŸåŠ¨ï¼Œå› ä¸ºæ„Ÿåˆ°è‡ªå·±çš„å¿ƒæ„æœ‰è¢«ä½ æ”¶åˆ°ï¼Œå¾—åˆ°äº†åé¦ˆçš„æ„Ÿè§‰ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- 6ï¼ˆlazy + skeletonï¼‰ -->
        <div class="card reveal">
          <div class="top">
            <div class="icon">ğŸŒŠ</div>
            <h3>æƒ å·ï¼Œ31å±‚çš„æ— è¾¹æ³³æ± </h3>
          </div>
          <div class="card-body">
            <div class="card-photo">
              <div class="img-retry"><button type="button">å›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œç‚¹æˆ‘é‡è¯•</button></div>
              <img
                src="https://quintailidev.github.io/kaixin-birthday/images/huizhou_pool2.jpg?v=3"
                alt="æƒ å·æ— è¾¹æ³³æ± "
                loading="lazy"
                decoding="async"
                referrerpolicy="no-referrer">
            </div>
            <div class="card-text">
              <p>
                æˆ‘ä»¬ä¸€èµ·å»æƒ å·æ—…è¡Œæ—¶ï¼Œä½ åœ¨æ— è¾¹æ³³æ± å’Œé‚£å¥—äº®è‰²æ³³è¡£å¾ˆæ­ï¼Œé‚£ä¸€åˆ»æˆ‘è§‰å¾—ä½ æ˜¯æ¸…å†·çƒ­çƒˆçš„ã€‚
                ä½ åœ¨æµ·è¾¹è¿ç€æµ·æµªï¼Œä½ è¿˜æ˜¯æ›´é€‚åˆçƒ­å¸¦çš„æµ·ï¼Œæ¯”å¦‚å¤å¨å¤·ã€é©¬å°”ä»£å¤«çš„æµ·ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- 5ï¼ˆlazy + skeletonï¼‰ -->
        <div class="card reveal">
          <div class="top">
            <div class="icon icon-perfume">
              <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M9 3.5c0-.55.45-1 1-1h4c.55 0 1 .45 1 1v2H9v-2Z" fill="rgba(180,140,60,0.95)" />
                <path
                  d="M8.5 5.5h7c.55 0 1 .45 1 1v1.2c0 .44-.29.83-.72.96l-1.28.38H9.5l-1.28-.38A1 1 0 0 1 7.5 7.7V6.5c0-.55.45-1 1-1Z"
                  fill="rgba(210,170,80,0.95)" />
                <path
                  d="M8.2 9.4c.12-.6.65-1.04 1.26-1.04h5.08c.6 0 1.14.44 1.26 1.04l1.1 5.7c.22 1.15-.66 2.2-1.83 2.2H8.93c-1.17 0-2.05-1.05-1.83-2.2l1.1-5.7Z"
                  fill="rgba(255,255,255,0.75)" stroke="rgba(255,255,255,0.75)" />
                <path
                  d="M9.2 14.1c.07-.4.42-.7.83-.7h3.94c.41 0 .76.29.83.7l.55 2.9c.1.54-.31 1.04-.86 1.04H9.51c-.55 0-.96-.5-.86-1.04l.55-2.9Z"
                  fill="rgba(255,77,141,0.55)" />
                <path d="M10.2 9.6c.4-.2.86-.3 1.8-.3" stroke="rgba(255,255,255,0.85)" stroke-width="1.2"
                  stroke-linecap="round" />
              </svg>
            </div>
            <h3>å¤ªå¤æ±‡ï¼Œè¿ªå¥¥å°å§</h3>
          </div>
          <div class="card-body">
            <div class="card-photo">
              <div class="img-retry"><button type="button">å›¾ç‰‡æ²¡åŠ è½½å‡ºæ¥ï¼Œç‚¹æˆ‘é‡è¯•</button></div>
              <img
                src="https://quintailidev.github.io/kaixin-birthday/images/dior5.jpg?v=3"
                alt="å¤ªå¤æ±‡çš„è¿ªå¥¥å°å§"
                loading="lazy"
                decoding="async"
                referrerpolicy="no-referrer">
            </div>
            <div class="card-text">
              <p>
                é‚£å¤©ï¼Œå’Œä½ åˆ°æŸœå°ä¹°äº†è¿ªå¥¥å°å§ï¼Œæˆ‘ç»™ä½ æ‹ç…§ï¼Œä½ å¼€å¿ƒçš„åƒä¸ªç‚«è€€ç¤¼ç‰©çš„å…¬ä¸»ã€‚
              </p>
            </div>
          </div>
        </div>

      </div>
    </section>

    <section class="section">
      <h2>æƒ³è·Ÿä½ è¯´çš„è¯</h2>
      <div class="letter" id="letter">
å‡¯é¦¨ï¼Œç”Ÿæ—¥å¿«ä¹ã€‚
æˆ‘æŠŠä¸€äº›æˆ‘å¾ˆå–œæ¬¢çš„ç”»é¢æ”¾è¿›è¿™ä¸ªé¡µé¢é‡Œï¼ŒåƒæŠŠæ˜Ÿæ˜Ÿè£…è¿›å£è¢‹ã€‚
ä½ æœ€è¿‘é¢è¯•è®ºæ–‡å¾ˆå¿™ï¼Œå°±å½“å®ƒæ˜¯ä¸€ä¸ªâ€œä½ æœ‰ç©ºå†æ‹†çš„ç¤¼ç‰©â€ï¼Œä¸ç”¨æ€¥ï¼Œä¹Ÿä¸ç”¨ç‰¹åœ°å›æˆ‘ã€‚
12.31é‚£æ™šç»™ä½ åº†ç”Ÿæˆ‘å¾ˆå¼€å¿ƒï¼Œä¹Ÿå¾ˆåº†å¹¸èƒ½å’Œä½ ä¸€èµ·è·¨è¿‡è¿™ä¸€å¹´ã€‚
ç¥ä½ é¡ºé¡ºåˆ©åˆ©ï¼Œå¤©å¤©å¼€å¿ƒã€‚
      </div>

      <div class="sign">Fromï¼šç¾¤å¤ªï¼ˆè®¤çœŸç‰ˆï¼‰</div>
    </section>

    <div class="footer">
      P.S. å¦‚æœä½ çœ‹åˆ°è¿™é‡Œï¼Œè¯´æ˜ä½ å·²ç»æ‰“å¼€äº†æˆ‘ç»™ä½ çš„â€œå°ç½‘é¡µâ€ã€‚é‚£å°±ï¼ŒæŠ±ä¸€ä¸‹ã€‚
    </div>
  </div>

  <script>
    /***********************
     * A) å›¾ç‰‡â€œç¨³æ€åŠ è½½å™¨â€
     * - è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰
     * - è¿”å›é¡µé¢æ—¶è‡ªåŠ¨æ‹‰èµ·æ²¡åŠ è½½æˆåŠŸçš„å›¾
     * - å¤±è´¥æ˜¾ç¤ºâ€œç‚¹æˆ‘é‡è¯•â€
     ***********************/
    (function setupRobustImageLoader() {
      const imgs = Array.from(document.querySelectorAll(".card-photo img"));
      const MAX_RETRY = 3;

      function withBuster(url) {
        try {
          const u = new URL(url, location.href);
          u.searchParams.delete("r");
          u.searchParams.set("r", Date.now().toString(36));
          return u.toString();
        } catch {
          const sep = url.includes("?") ? "&" : "?";
          return url + sep + "r=" + Date.now().toString(36);
        }
      }

      function markLoaded(img) {
        const box = img.closest(".card-photo");
        if (!box) return;
        box.classList.add("is-loaded");
        box.classList.remove("is-failed");
        img.dataset.failed = "0";
      }

      function markFailed(img) {
        const box = img.closest(".card-photo");
        if (!box) return;
        box.classList.add("is-failed");
        img.dataset.failed = "1";
      }

      function scheduleRetry(img, reason) {
        const retry = parseInt(img.dataset.retry || "0", 10);
        if (retry >= MAX_RETRY) {
          markFailed(img);
          return false;
        }
        img.dataset.retry = String(retry + 1);

        // æŒ‡æ•°é€€é¿ + æŠ–åŠ¨ï¼šç½‘ç»œå·®æ—¶æ›´ç¨³
        const delay = Math.min(7000, 650 * Math.pow(2, retry)) + Math.floor(Math.random() * 400);

        // å¦‚æœå½“å‰åœ¨åå°ï¼Œå°±å…ˆæ ‡è®°ï¼Œç­‰å›åˆ°å‰å°å†é‡è¯•
        if (document.visibilityState !== "visible") {
          img.dataset.pendingRetry = "1";
          return true;
        }

        setTimeout(() => {
          if (document.visibilityState !== "visible") {
            img.dataset.pendingRetry = "1";
            return;
          }
          const base = img.dataset.src0 || img.currentSrc || img.src;
          img.src = withBuster(base);
        }, delay);

        return true;
      }

      function ensureRetryButton(img) {
        const box = img.closest(".card-photo");
        if (!box) return;
        const btn = box.querySelector(".img-retry button");
        if (!btn) return;

        btn.addEventListener("click", () => {
          // æ‰‹åŠ¨é‡è¯•ï¼šæŠŠæ¬¡æ•°æ¸…é›¶ï¼Œç«‹å³æ‹‰èµ·
          img.dataset.retry = "0";
          img.dataset.pendingRetry = "0";
          box.classList.remove("is-failed");
          const base = img.dataset.src0 || img.currentSrc || img.src;
          img.src = withBuster(base);
        });
      }

      // 1) ç»‘å®š skeleton/é‡è¯•é€»è¾‘
      imgs.forEach(img => {
        img.dataset.src0 = img.getAttribute("src") || img.src;
        img.dataset.retry = img.dataset.retry || "0";
        img.dataset.failed = "0";
        ensureRetryButton(img);

        const box = img.closest(".card-photo");
        if (!box) return;

        const onLoad = () => markLoaded(img);
        const onError = () => {
          // å¤±è´¥æ—¶ï¼šå…ˆè‡ªåŠ¨é‡è¯•ï¼Œè¶…è¿‡æ¬¡æ•°å†æ˜¾ç¤ºæŒ‰é’®
          const ok = scheduleRetry(img, "error");
          if (!ok) markFailed(img);
        };

        img.addEventListener("load", onLoad);
        img.addEventListener("error", onError);

        // å·²ç»ç¼“å­˜æˆåŠŸçš„ç›´æ¥æ ‡è®°
        if (img.complete && img.naturalWidth > 0) markLoaded(img);
      });

      // 2) è®© lazy å›¾æ›´â€œä¸»åŠ¨â€ï¼šæ¥è¿‘è§†å£æ—¶å°±å¼ºåˆ¶ eagerï¼Œå¹¶ä¸”å¦‚æœå¤±è´¥äº†å°±è¡¥ä¸€åˆ€
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (!e.isIntersecting) return;
          const img = e.target;
          // è®©æµè§ˆå™¨åˆ«å¤ªä½›ç³»
          try { img.loading = "eager"; } catch {}
          // å¦‚æœä¹‹å‰å¤±è´¥/æˆ–æŒ‚èµ·è¿‡ï¼Œè¿›è§†å£æ—¶ç›´æ¥é‡è¯•ä¸€æ¬¡
          if ((img.complete && img.naturalWidth === 0) || img.dataset.failed === "1") {
            scheduleRetry(img, "inview");
          }
        });
      }, { rootMargin: "900px 0px", threshold: 0.01 });

      imgs.forEach(img => io.observe(img));

      // 3) è¿”å›é¡µé¢æ—¶ï¼šæŠŠ pending çš„ã€å¡ä½çš„å›¾é‡æ–°æ‹‰èµ·
      function resumeImages() {
        if (document.visibilityState !== "visible") return;

        imgs.forEach(img => {
          const stuck = (img.complete && img.naturalWidth === 0);
          const pending = img.dataset.pendingRetry === "1";
          const failed = img.dataset.failed === "1";

          if (pending || stuck || failed) {
            img.dataset.pendingRetry = "0";
            scheduleRetry(img, "resume");
          }
        });
      }

      document.addEventListener("visibilitychange", resumeImages);
      window.addEventListener("pageshow", resumeImages);
      window.addEventListener("focus", resumeImages);
      window.addEventListener("online", resumeImages);

      // 4) é¡µé¢å±•ç¤ºåï¼Œåå°â€œæ¸©æŸ”é¢„çƒ­â€å‰©ä½™å›¾ç‰‡ï¼ˆå¹¶å‘2ï¼Œä¸ä¼šå‹æ­»ç§»åŠ¨ç½‘ç»œï¼‰
      function warmPreloadAll() {
        if (document.visibilityState !== "visible") return;
        const list = imgs.filter(img => !(img.complete && img.naturalWidth > 0));
        if (!list.length) return;

        let idx = 0;
        let active = 0;
        const CONCURRENCY = 2;

        const next = () => {
          while (active < CONCURRENCY && idx < list.length) {
            const target = list[idx++];
            const src = target.dataset.src0 || target.src;
            active++;

            const pre = new Image();
            pre.decoding = "async";
            pre.referrerPolicy = "no-referrer";
            pre.onload = () => { active--; next(); };
            pre.onerror = () => { active--; next(); };
            pre.src = src;
          }
        };
        next();
      }

      // æš´éœ²ç»™å¤–éƒ¨ï¼šé¦–å±å±•ç¤ºåå†è°ƒç”¨
      window.__warmPreloadAllImages = warmPreloadAll;
      window.__resumeImages = resumeImages;
    })();

    /***********************
     * B) Loaderï¼šåªç­‰ data-critical="1" çš„å…³é”®å›¾åŠ è½½å®Œå°±å±•ç¤ºé¡µé¢
     ***********************/
    async function waitCriticalImagesThenShow() {
      const overlay = document.getElementById("loaderOverlay");
      const textEl = document.getElementById("loaderText");

      const criticalImgs = Array.from(document.querySelectorAll('img[data-critical="1"]'));
      const total = criticalImgs.length || 1;
      let done = 0;

      const setProgress = () => {
        const pct = Math.min(100, Math.round((done / total) * 100));
        if (textEl) textEl.textContent = `æ­£åœ¨æ‰“å¼€ç¤¼ç‰©â€¦ ${pct}%`;
      };

      const waitOne = (img) => new Promise((resolve) => {
        const finish = () => { done++; setProgress(); resolve(); };

        if (img.complete && img.naturalWidth > 0) {
          if (img.decode) img.decode().catch(() => { }).finally(finish);
          else finish();
          return;
        }

        const onLoad = () => { cleanup(); if (img.decode) img.decode().catch(() => { }).finally(finish); else finish(); };
        const onError = () => { cleanup(); finish(); };
        const cleanup = () => {
          img.removeEventListener("load", onLoad);
          img.removeEventListener("error", onError);
        };

        img.addEventListener("load", onLoad, { once: true });
        img.addEventListener("error", onError, { once: true });
      });

      setProgress();

      const TIMEOUT_MS = 9000; // å…œåº•ï¼š9ç§’è¿˜æ²¡å¥½ä¹Ÿå…ˆå±•ç¤º
      await Promise.race([
        Promise.all(criticalImgs.map(waitOne)),
        new Promise(res => setTimeout(res, TIMEOUT_MS))
      ]);

      document.documentElement.classList.remove("is-loading");
      if (overlay) {
        overlay.classList.add("hide");
        setTimeout(() => overlay.remove(), 450);
      }

      // âœ… é¡µé¢å±•ç¤ºåï¼šé¢„çƒ­å…¶ä½™å›¾ç‰‡ï¼ˆä½ åˆ‡èµ°å†å›æ¥ä¹Ÿæ›´å®¹æ˜“åŠ è½½å®Œï¼‰
      if (window.__warmPreloadAllImages) {
        // ç«‹åˆ»é¢„çƒ­ä¸€æ³¢
        window.__warmPreloadAllImages();
        // å†å»¶è¿Ÿè¡¥ä¸€æ³¢ï¼ˆç»™ç½‘ç»œå–˜å£æ°”ï¼‰
        setTimeout(() => window.__warmPreloadAllImages && window.__warmPreloadAllImages(), 1800);
      }

      // âœ… é¡µé¢çœŸæ­£å±•ç¤ºåå†å¯åŠ¨çˆ±å¿ƒ/å€’è®¡æ—¶/äº¤äº’
      initHeartsAndUI();
    }

    /***********************
     * 0) çˆ±å¿ƒç³»ç»Ÿ + UIç»‘å®šï¼ˆç­‰é¦–å±å±•ç¤ºåå†å¯åŠ¨ï¼‰
     ***********************/
    function initHeartsAndUI() {
      function createHeart() {
        const heart = document.createElement("div");
        heart.className = "heart";
        heart.textContent = "â¤";
        heart.style.left = (Math.random() * 100) + "vw";
        heart.style.fontSize = (14 + Math.random() * 14) + "px";
        heart.style.opacity = (0.45 + Math.random() * 0.35).toFixed(2);
        heart.style.animationDuration = (6.5 + Math.random() * 3.5).toFixed(2) + "s";
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 9000);
      }

      let heartTimer = null;
      const baseRate = 1200;
      const boostRate = 220;
      const boostMsClick = 3800;
      const boostMsBirthday = 5000;
      let boostTimeout = null;

      function startBaseHearts() {
        if (heartTimer) return;
        heartTimer = setInterval(createHeart, baseRate);
      }

      function setHeartRate(ms) {
        if (!heartTimer) return;
        clearInterval(heartTimer);
        heartTimer = setInterval(createHeart, ms);
      }

      function burstHearts(count = 22, interval = 70) {
        for (let i = 0; i < count; i++) setTimeout(createHeart, i * interval);
      }

      function triggerHeartsBoost(durationMs) {
        setHeartRate(boostRate);
        if (boostTimeout) clearTimeout(boostTimeout);
        boostTimeout = setTimeout(() => setHeartRate(baseRate), durationMs);
      }

      for (let i = 0; i < 6; i++) setTimeout(createHeart, i * 180);
      startBaseHearts();

      function pad(n) { return String(n).padStart(2, '0'); }
      let countdownTimer = null;
      let birthdayHeartsTriggered = false;

      function isJan10(d) { return d.getMonth() === 0 && d.getDate() === 10; }
      function getNextBirthday(now) {
        if (isJan10(now)) return new Date(now.getFullYear(), 0, 10, 0, 0, 0);
        let y = now.getFullYear();
        let target = new Date(y, 0, 10, 0, 0, 0);
        if (now > target) target = new Date(y + 1, 0, 10, 0, 0, 0);
        return target;
      }

      const DEBUG_DATE = null;
      function getNow() { return DEBUG_DATE ? new Date(DEBUG_DATE) : new Date(); }

      function updateCountdown() {
        const el = document.getElementById("countdown");
        if (!el) return;

        const now = getNow();

        if (isJan10(now)) {
          el.textContent = "ğŸ‰ ä»Šå¤©å°±æ˜¯ä½ çš„ç”Ÿæ—¥å•¦ã€‚ç”Ÿæ—¥å¿«ä¹ï¼";

          if (!birthdayHeartsTriggered) {
            birthdayHeartsTriggered = true;
            burstHearts(30, 55);
            triggerHeartsBoost(boostMsBirthday);
          }

          if (countdownTimer) clearInterval(countdownTimer);
          countdownTimer = null;
          return;
        }

        const target = getNextBirthday(now);
        const diff = target - now;

        const totalSec = Math.max(0, Math.floor(diff / 1000));
        const d = Math.floor(totalSec / (3600 * 24));
        const h = Math.floor((totalSec % (3600 * 24)) / 3600);
        const m = Math.floor((totalSec % 3600) / 60);
        const s = totalSec % 60;

        const yy = target.getFullYear();
        el.textContent = `è·ç¦» ${yy}.01.10 è¿˜æœ‰ï¼š${d} å¤© ${pad(h)}:${pad(m)}:${pad(s)} âœ¨`;
      }

      updateCountdown();
      countdownTimer = setInterval(updateCountdown, 1000);

      document.getElementById("btnHearts")?.addEventListener("click", () => {
        burstHearts(22, 70);
        triggerHeartsBoost(boostMsClick);
      });

      document.getElementById("btnScroll")?.addEventListener("click", () => {
        document.getElementById("memories")?.scrollIntoView({ behavior: "smooth", block: "start" });
      });

      const cards = Array.from(document.querySelectorAll(".reveal"));
      const io = new IntersectionObserver((entries) => {
        entries.forEach(e => {
          if (e.isIntersecting) e.target.classList.add("show");
        });
      }, { threshold: 0.15 });
      cards.forEach(c => io.observe(c));

      // âœ… å›åˆ°å‰å°æ—¶é¡ºæ‰‹å†å”¤é†’ä¸€æ¬¡å›¾ç‰‡ï¼ˆæ›´ç¨³ï¼‰
      document.addEventListener("visibilitychange", () => {
        if (document.visibilityState === "visible" && window.__resumeImages) {
          window.__resumeImages();
          window.__warmPreloadAllImages && window.__warmPreloadAllImages();
        }
      });
    }

    // âœ… å¼€å§‹ï¼šå…ˆç­‰å…³é”®å›¾ï¼Œå†å±•ç¤ºé¡µé¢ï¼Œå†å¯åŠ¨çˆ±å¿ƒä¸äº¤äº’
    waitCriticalImagesThenShow();
  </script>
</body>

</html>
